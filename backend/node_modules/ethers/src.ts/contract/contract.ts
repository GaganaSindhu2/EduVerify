const hre = require("hardhat");

async function main() {
  // Replace with your MetaMask or admin wallet address
  const adminAddress = "0x12EC62AE8980f26D48Be53f06F8ad10AaEA80Fef";

  // ✅ Deploy SRNValidator
  const SRNValidator = await hre.ethers.getContractFactory("SRNValidator");
  const srnValidator = await SRNValidator.deploy();
  await srnValidator.waitForDeployment();
  console.log("SRNValidator deployed to:", await srnValidator.getAddress());

  // ✅ Deploy AccessControl with admin address
  const AccessControl = await hre.ethers.getContractFactory("AccessControl");
  const accessControl = await AccessControl.deploy(adminAddress);
  await accessControl.waitForDeployment();
  console.log("AccessControl deployed to:", await accessControl.getAddress());

  // ✅ Deploy CredentialManager using AccessControl & SRNValidator
  const CredentialManager = await hre.ethers.getContractFactory("CredentialManager");
  const credentialManager = await CredentialManager.deploy(
    await accessControl.getAddress(),
    await srnValidator.getAddress()
  );
  await credentialManager.waitForDeployment();
  console.log("CredentialManager deployed to:", await credentialManager.getAddress());
}

main().catch((error) => {
  console.error("Deployment failed:", error);
  process.exitCode = 1;
});
